<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MediPredict | Clinical Decision Support</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/framer-motion@11/dist/framer-motion.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/recharts@2.12.7/umd/Recharts.min.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js">
  </script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
    rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    .map-container .map-element {
      height: 500px !important;
      width: 100% !important;
    }

    .animate-in {
      animation: fadeIn 0.5s ease-out;
    }

    .slide-in-from-bottom-4 {
      animation: slideInBottom 0.5s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes slideInBottom {
      from {
        opacity: 0;
        transform: translateY(16px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .chart-container {
      height: 256px;
      width: 100%;
    }
  </style>
</head>

<body class="bg-slate-50">
  <div id="root"></div>

  <script type="text/babel">

    // =====================================================================
    //  DATA & CONSTANTS (ADD THIS FIRST)
    // ===================================================================


    const SYSTEM_STATS = [
      { year: '2020', patients: 1200, tests: 3400 },
      { year: '2021', patients: 1900, tests: 4500 },
      { year: '2022', patients: 3400, tests: 7800 },
      { year: '2023', patients: 5100, tests: 11000 },
      { year: '2024', patients: 7800, tests: 15400 },
    ];

    const MOCK_LAB_PATIENTS = [
      { id: "P-101", name: "Sarah Miller", age: 45, status: "Completed" },
      { id: "P-102", name: "Omar Youssef", age: 62, status: "Pending" },
      { id: "P-103", name: "Layla Mahmoud", age: 29, status: "Processing" },
    ];

    const LAB_BRANCHES = [];


    // =====================================================================
    //  HOOKS (FIXED - useApi/useAuth as functions)
    // =====================================================================
    function useApi(url) {
      const [data, setData] = React.useState(null);
      const [loading, setLoading] = React.useState(true);
      const [error, setError] = React.useState(null);

      React.useEffect(() => {
        fetch(url)
          .then(res => {
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            return res.json();
          })
          .then(setData)
          .catch(err => setError(err.message))
          .finally(() => setLoading(false));
      }, [url]);

      return { data, loading, error };
    }

    function useAuth() {
      const [user, setUser] = React.useState(null);
      const [loading, setLoading] = React.useState(false);

      const register = async (credentials) => {
        setLoading(true);
        try {
          const response = await fetch('/api/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(credentials)
          });
          const data = await response.json();
          if (data.success) {
            localStorage.setItem('patient_user', JSON.stringify(data));
            return true;
          }
          throw new Error(data.error || 'Registration failed');
        } catch (err) {
          alert(`âŒ ${err.message}`);
          return false;
        } finally {
          setLoading(false);
        }
      };

      React.useEffect(() => {
        const saved = localStorage.getItem('patient_user');
        if (saved) {
          try {
            setUser(JSON.parse(saved));
          } catch (e) {
            localStorage.removeItem('patient_user');
          }
        }
      }, []);

      return { user, register, loading };
    }

    // =====================================================================
    // SHARED UI COMPONENTS (REPLACE BUTTON)
    // =====================================================================
    function Button({ children, onClick, variant = "primary", className = "", icon, loading = false, type = "button" }) {
      const base = "px-4 py-2 rounded-md font-medium transition-all duration-200 flex items-center justify-center gap-2 text-sm";
      const styles = {
        primary: "bg-[#0ea5e9] hover:bg-[#0284c7] text-white shadow-sm",
        secondary: "bg-white border border-slate-300 text-slate-700 hover:bg-slate-50",
        outline: "border border-[#0ea5e9] text-[#0ea5e9] hover:bg-blue-50",
        ghost: "text-slate-500 hover:text-slate-800 hover:bg-slate-100",
        danger: "bg-rose-500 text-white hover:bg-rose-600",
      };
      return (
        <button
          disabled={loading}
          type={type}
          onClick={onClick}
          className={`${base} ${styles[variant] || ''} ${className} ${loading ? 'opacity-50 cursor-not-allowed' : ''}`}
        >
          {loading ? (
            <i className="ri-loader-2 line animate-spin text-sm"></i>
          ) : (
            icon && <i className={`${icon} text-sm`}></i>
          )}
          {children}
        </button>
      );
    }
    function Input({ label, type = "text", placeholder, value, onChange, error }) {
      return (
        <div className="flex flex-col gap-1 w-full">
          {label && (
            <label className="text-xs font-semibold text-slate-600 uppercase tracking-wide">
              {label}
            </label>
          )}
          <input
            type={type}
            placeholder={placeholder}
            value={value}
            onChange={onChange}
            className={`w-full px-3 py-2 rounded border transition-all text-sm text-slate-800 bg-white ${error
              ? 'border-rose-300 focus:border-rose-500 focus:ring-rose-500 bg-rose-50'
              : 'border-slate-300 focus:border-[#0ea5e9] focus:ring-[#0ea5e9]'
              }`}
            required
          />
          {error && <p className="text-rose-600 text-xs mt-1">{error}</p>}
        </div>
      );
    }

    // =====================================================================
    // 4. LANDING PAGE
    // =====================================================================
    function LandingPage({ onSelectRole }) {
      return (
        <div className="min-h-screen bg-slate-50 flex flex-col">
          <nav className="bg-white border-b border-slate-200 px-8 py-4 flex justify-between items-center sticky top-0 z-50">
            <div className="flex items-center gap-2">
              <div className="w-8 h-8 bg-[#0ea5e9] rounded flex items-center justify-center text-white font-bold">MP</div>
              <span className="text-lg font-bold text-slate-800">MediPredict <span className="font-normal text-slate-500">Health System</span></span>
            </div>
            <div className="text-sm text-slate-500">Clinical Decision Support v3.0</div>
          </nav>

          <div className="flex-1 flex items-center justify-center p-6">
            <div className="max-w-5xl w-full grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
              <div>
                <h1 className="text-4xl md:text-5xl font-extrabold text-slate-900 mb-6 leading-tight">
                  Advanced Cardiovascular <br />Risk Analytics.
                </h1>
                <p className="text-lg text-slate-600 mb-8 leading-relaxed">
                  An integrated platform connecting patients with clinical laboratories for accurate, AI-driven heart disease prediction and monitoring.
                </p>
                <div className="flex flex-col gap-4">
                  <div
                    onClick={() => { window.location.href = '/guest'; }}
                    className="group flex items-center gap-4 p-4 bg-white rounded-xl border border-slate-200 shadow-sm cursor-pointer hover:border-[#0ea5e9] hover:shadow-md transition-all"
                  >
                    {/* Icon on the left */}
                    <div className="w-12 h-12 rounded-full bg-sky-50 text-sky-600 flex items-center justify-center group-hover:bg-sky-600 group-hover:text-white transition-colors">
                      <i className="ri-eye-line text-xl"></i> {/* eye icon for guest view */}
                    </div>
                    <div>
                      <h3 className="font-bold text-slate-800">Explore as Guest</h3>
                      <p className="text-sm text-slate-500">View public health statistics and datasets.</p>
                    </div>
                  </div>

                  <div onClick={() => { window.location.href = '/patient'; }}
                    className="group flex items-center gap-4 p-4 bg-white rounded-xl border border-slate-200 shadow-sm cursor-pointer hover:border-emerald-500 hover:shadow-md transition-all">
                    <div className="w-12 h-12 rounded-full bg-emerald-50 text-emerald-600 flex items-center justify-center group-hover:bg-emerald-600 group-hover:text-white transition-colors">
                      <i className="ri-login-circle-line text-xl"></i>
                    </div>
                    <div>
                      <h3 className="font-bold text-slate-800">Patient Login</h3>
                      <p className="text-sm text-slate-500">Access your account.</p>
                    </div>
                  </div>


                  <div
                    onClick={() => { window.location.href = '/lab'; }}
                    className="group flex items-center gap-4 p-4 bg-slate-800 rounded-xl border border-slate-700 shadow-sm cursor-pointer hover:bg-slate-700 transition-all"
                  >                    <div className="w-12 h-12 rounded-full bg-slate-700 text-teal-400 flex items-center justify-center group-hover:bg-teal-500 group-hover:text-white transition-colors">
                      <i className="ri-flask-line text-xl"></i>
                    </div>
                    <div>
                      <h3 className="font-bold text-white">Laboratory Login</h3>
                      <p className="text-sm text-slate-400">For authorized clinical personnel only.</p>
                    </div>
                  </div>
                </div>
              </div>
              <div className="hidden md:flex justify-center">
                <div className="relative w-80 h-96 bg-white rounded-2xl shadow-2xl border border-slate-100 p-6 rotate-3">
                  <div className="h-4 w-20 bg-slate-100 rounded mb-6"></div>
                  <div className="space-y-4">
                    <div className="h-24 bg-blue-50 rounded-xl w-full"></div>
                    <div className="h-24 bg-emerald-50 rounded-xl w-full"></div>
                    <div className="h-24 bg-slate-50 rounded-xl w-full"></div>
                  </div>
                  <div className="absolute -bottom-6 -left-6 bg-white p-4 rounded-xl shadow-xl border border-slate-100 flex items-center gap-3">
                    <i className="ri-check-circle-line text-emerald-500 text-xl"></i>
                    <div>
                      <div className="text-xs font-bold text-slate-400">SYSTEM STATUS</div>
                      <div className="text-sm font-bold text-slate-800">Operational</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // =====================================================================
    // MAIN APP CONTROLLER
    // =====================================================================
function App() {
  const [view, setView] = React.useState("landing");
  const { user: authUser } = useAuth();

  return (
    <div>
      {view === "landing" && <LandingPage onSelectRole={setView} />}
      {/* remove lab_login and lab_dash lines */}
    </div>
  );
}



    // =====================================================================
    // RENDER APP
    // =====================================================================
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
    lucide.createIcons();
  </script>
</body>

</html>